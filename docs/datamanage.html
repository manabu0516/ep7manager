<!doctype html>
<html lang="ja">

<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css"
        integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO" crossorigin="anonymous">

    <title>EPIC SEVEN - JSON GENERATOR</title>

    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-143765558-2"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());

        gtag('config', 'UA-143765558-2');
    </script>
</head>

<body>
    <div class="navbar navbar-expand-lg fixed-top navbar-dark bg-info">
        <div class="container">
            <a href="./" class="navbar-brand">EPIC SEVEN - JSON GENERATO</a>
            <button class="navbar-toggler" type="button" data-toggle="collapse" data-target="#navbarResponsive"
                aria-controls="navbarResponsive" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>
            <div class="collapse navbar-collapse" id="navbarResponsive">
                <ul class="navbar-nav">
                    <li class="nav-item">
                        <a class="nav-link" href="./index.html">英雄データ</a>
                    </li>
                    <li class="nav-item active">
                        <a class="nav-link" href="./build.html">装備データ</a>
                    </li>
                    <li class="nav-item">
                        <a class="nav-link" href="./datamanage.html">ステータス管理</a>
                    </li>
                </ul>

            </div>
        </div>
    </div>

    <div class="container" style="padding-top: 70px;">
        <div class="row">
            <div class="col-lg-12">
                <div class="form-group">
                    <label for="pass-input">パスワード</label>
                    <input type="text" class="form-control" id="pass-input" autocomplete="off">
                </div>
                <datalist id="herolist">
                </datalist>
            </div>
        </div>

        <div class="row" id="content">
        </div>
    </div>

    <footer class="container">
        <hr />
        <ul style="list-style: none;">
            <li style="display: inline-block;margin-right: 10px;"><a
                    href="https://maphe.github.io/e7-damage-calc/jp/">エピックセブン ダメージ 計算機</a></li>
            <li style="display: inline-block;"><a href="https://game8.jp/epic-seven">エピックセブン攻略Wiki｜ゲームエイト</a></li>
        </ul>
        <p>COPYRIGHT &#169; <a href="https://github.com/manabu0516/ep7manager">fmnb0516</a> ALL RIGHTS
            RESERVED. </p>
    </footer>

    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js"
        integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.14.3/umd/popper.min.js"
        integrity="sha384-ZMP7rVo3mIykV+2+9J3UJ46jBk0WLaUAdn689aCwoqbBJiSnjAK/l8WvCWPIPm49"
        crossorigin="anonymous"></script>
    <script src="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/js/bootstrap.min.js"
        integrity="sha384-ChfqqxuZUCnJSK3+MXmPNIyE6ZbWh2IMqE241rYiqJxyMiZ6OW/JmZQ5stwEULTy"
        crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/handlebars.js/4.7.3/handlebars.min.js"
        integrity="sha256-/PJBs6QWvXijOFIX04kZpLb6ZtSQckdOIavLWKKOgXU=" crossorigin="anonymous"></script>
    
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/luminous-lightbox@2.4.0/dist/luminous-basic.min.css">
    <script src="https://cdn.jsdelivr.net/npm/luminous-lightbox@2.4.0/dist/luminous.min.js"></script>

    <script>
        Handlebars.registerHelper('filter', function(flg) {
            return flg ? "btn-primary" : "btn-light";
        });

        $(() => {
            const context = {
                entries : [],
                filters : {
                    "fire" : false,
                    "ice"  : false,
                    "earth": false,
                    "light": false,
                    "dark" : false,
                    "knight": false,
                    "warrior" : false,
                    "thie" : false,
                    "mage" : false,
                    "soulweaver" : false,
                    "ranger" : false,
                    "star3" : false,
                    "star4" : false,
                    "star5" : false,
                }
            };
            
            const updateView = async () => {
                const pass = location.hash.substring(1);
                if(pass === "") {
                    return;
                }
                const url = "https://test707-dev-ed.develop.my.salesforce-sites.com/services/apexrest/status/get/"+pass;

                const response = await fetch(url, { method: 'POST'});
                const json = await response.json();
                context.entries = json.data;
                renderView(context);
            };

            const renderView = (() => {
                const template = Handlebars.compile($("#template").html());
                return (json) => {
                    console.log(json);
                    $("#content").html(template(json));
                };
            })();

            window.addEventListener('hashchange', function() {
                updateView();
            }, false);

            $("#pass-input").change((e) => {
                const pass = $("#pass-input").val().trim();
                if(pass === "") {
                    return;
                }
                location.hash = pass;
            });

            $("body").on("click", ".filter-btn", function() {
                const key = $(this).attr("data-filter");
                context.filters[key] = context.filters[key] === false;
                updateView();
            });

            $("#pass-input").val(location.hash.substring(1));
            updateView();

        });

    </script>

    <script type="text/x-handlebars" id="template">
        <div class="btn-toolbar" role="toolbar" aria-label="Toolbar with button groups" style="margin-bottom: 10px">
            <div class="btn-group mr-2" role="group">
                <button type="button" class="btn {{filter filters.fire}} filter-btn" data-filter="fire">火</button>
                <button type="button" class="btn {{filter filters.ice}} filter-btn" data-filter="ice">氷</button>
                <button type="button" class="btn {{filter filters.earth}} filter-btn" data-filter="earth">木</button>
                <button type="button" class="btn {{filter filters.light}} filter-btn" data-filter="light">光</button>
                <button type="button" class="btn {{filter filters.dark}} filter-btn" data-filter="dark">闇</button>
            </div>
            <div class="btn-group mr-2" role="group">
                <button type="button" class="btn {{filter filters.knight}} filter-btn" data-filter="knight"><img style="width: 20px;" src="https://assets.epicsevendb.com/class/cm_icon_role_knight.png"></button>
                <button type="button" class="btn {{filter filters.warrior}} filter-btn" data-filter="warrior"><img style="width: 20px;" src="https://assets.epicsevendb.com/class/cm_icon_role_warrior.png"></button>
                <button type="button" class="btn {{filter filters.thie}} filter-btn" data-filter="thie"><img style="width: 20px;" src="https://assets.epicsevendb.com/class/cm_icon_role_thief.png"></button>
                <button type="button" class="btn {{filter filters.mage}} filter-btn" data-filter="mage"><img style="width: 20px;" src="https://assets.epicsevendb.com/class/cm_icon_role_mage.png"></button>
                <button type="button" class="btn {{filter filters.soulweaver}} filter-btn"data-filter="soulweaver"><img style="width: 20px;" src="https://assets.epicsevendb.com/class/cm_icon_role_soul-weaver.png"></button>
                <button type="button" class="btn {{filter filters.ranger}} filter-btn" data-filter="ranger"><img style="width: 20px;" src="https://assets.epicsevendb.com/class/cm_icon_role_ranger.png"></button>
            </div>
            <div class="btn-group mr-2" role="group">
                <button type="button" class="btn {{filter filters.star3}} filter-btn" data-filter="star3">★3</button>
                <button type="button" class="btn {{filter filters.star4}} filter-btn" data-filter="star4">★4</button>
                <button type="button" class="btn {{filter filters.star5}} filter-btn" data-filter="star5">★5</button>
            </div>
        </div>

        <table class="table">
            <thead>
                <tr>
                    <th scope="col">#</th>
                    <th scope="col">属性</th>
                    <th scope="col">職業</th>
                    <th scope="col">レア</th>
                    <th scope="col">名称</th>
                    <th scope="col">攻撃</th>
                    <th scope="col">生命</th>
                    <th scope="col">防御</th>
                    <th scope="col">速度</th>
                    <th scope="col">クリ率</th>
                    <th scope="col">クリダメ</th>
                    <th scope="col">効果命中</th>
                    <th scope="col">効果抵抗</th>
                    <th scope="col">連携</th>
                </tr>
                {{#each entries}}
                <tr>
                    <td>{{name}}</td>
                    <td>{{attr}}</td>
                    <td>{{job}}</td>
                    <td>{{rare}}</td>
                    <td>{{HeroName}}</td>
                    <td>{{Attack}}</td>
                    <td>{{Health}}</td>
                    <td>{{Defense}}</td>
                    <td>{{Speed}}</td>
                    <td>{{CriticalHit}}%</td>
                    <td>{{CriticalDamage}}%</td>
                    <td>{{effect}}%</td>
                    <td>{{resist}}%</td>
                    <td>{{combination}}%</td>
                </tr>
                {{/each}}
            </thead>
        </table>
    </script>

</body>

</html>